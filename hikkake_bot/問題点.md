# `hikkake_bot` の主な問題点と改善案

`hikkake_bot` のコードベースを調査した結果、機能の信頼性、保守性、およびユーザー体験に影響を与える可能性のある、以下の主要な問題点が特定されました。

---

### 1. 致命的なハンドラ読み込みエラー

**問題点:**
`hikkake_bot` のすべてのインタラクション（ボタン、メニュー操作）を処理するハンドラが、Bot本体に全く読み込まれていませんでした。これは、機能のエントリポイントである `hikkake_bot/index.js` がハンドラを `handlers` という名前でエクスポートしているのに対し、Bot本体 (`events/interactionCreate.js`) は `componentHandlers` という名前で読み込もうとしている、という名前の不一致が原因です。

**影響:**
この問題により、`hikkake_bot` のすべてのボタンやセレクトメニューが押されても反応せず、インタラクションがタイムアウトして失敗していました。これは機能不全に直結する致命的なエラーです。

---

### 2. データモデルの不整合

**問題点:**
「同伴」機能で記録されるデータ構造が、「ひっかけ」や「ふらっと来店」のデータ構造と異なっていました。具体的には、`douhanData` というネストされたオブジェクトに情報が格納されており、他のイベントと形式が統一されていません。

**影響:**
将来的にデータを集計・分析する際に、イベントの種類によって異なる処理を実装する必要が生じ、コードが複雑化し、バグの原因となります。

---

### 3. ユーザーへのフィードバック不足

**問題点:**
「スタッフ数設定」などの管理操作を完了した際に、「設定しました」という画一的なメッセージが表示されるだけで、具体的にどのような設定が反映されたのかがユーザーに伝わりません。

**影響:**
管理者が自分の操作が正しく行われたかを確認しにくく、ユーザー体験を損ねています。

---

### 4. 注文キャンセル機能の不具合

**問題点:**
スレッドに記録された注文をキャンセルするためのボタン (`cancel_order_...`) が、メインの処理振り分け機能の対象外 (`hikkake_...` のみ) となっていたため、押しても全く反応しない状態でした。

**影響:**
重要な管理機能が意図通りに動作していませんでした。

---

### 5. 入力値の検証不足

**問題点:**
「同伴」や「カスタムリアクション」の情報を入力するモーダルにおいて、数値項目に文字列が入力されたり、負の数が入力されたりしてもエラーにならず、不正なデータが保存されてしまう可能性がありました。

**影響:**
データの信頼性が低下し、予期せぬバグの原因となります。